# Getting started with Serenity and Cucumber

Serenity BDD is a library that makes it easier to write high quality automated acceptance tests, with powerful reporting and living documentation features. It has strong support for both web testing with Selenium, and API testing using RestAssured.

Serenity strongly encourages good test automation design, and supports several design patterns, including classic Page Objects, the newer Lean Page Objects/ Action Classes approach, and the more sophisticated and flexible Screenplay pattern.

The latest version of Serenity supports Cucumber 5.5.

## The starter project
The best place to start with Serenity and Cucumber is to clone or download the starter project on Github ([https://github.com/serenity-bdd/serenity-cucumber-starter](https://github.com/serenity-bdd/serenity-cucumber-starter)). This project gives you a basic project setup, along with some sample tests and supporting classes. There are two versions to choose from. The master branch uses a more classic approach, using action classes and lightweight page objects, whereas the **[screenplay](https://github.com/serenity-bdd/serenity-cucumber-starter/tree/screenplay)** branch shows the same sample test implemented using Screenplay.

### The project directory structure
The project has build scripts for both Maven and Gradle, and follows the standard directory structure used in most Serenity projects:
```Gherkin
src
  + main
  + test
    + java                        Test runners and supporting code
    + resources
      + features                  Feature files
     + search                  Feature file subdirectories 
             get_product.feature
```

## Executing the tests
To run the project, you can either just run the `CucumberTestSuite` test runner class, or run either `mvn clean verify` from the command line.

The test results will be recorded in the `target/site/serenity` directory.

## Generating the reports
# Locallly generating reports from command line
Since the Serenity reports contain aggregate information about all of the tests, they are not generated after each individual test (as this would be extremenly inefficient). Rather, The Full Serenity reports are generated by the `serenity-maven-plugin`. You can trigger this by running `mvn serenity:aggregate` from the command line or from your IDE.
  
  They reports are also integrated into the Maven build process: the following code in the `pom.xml` file causes the reports to be generated automatically once all the tests have completed when you run `mvn verify`?

```
             <plugin>
                <groupId>net.serenity-bdd.maven.plugins</groupId>
                <artifactId>serenity-maven-plugin</artifactId>
                <version>${serenity.maven.version}</version>
                <configuration>
                    <tags>${tags}</tags>
                </configuration>
                <executions>
                    <execution>
                        <id>serenity-reports</id>
                        <phase>post-integration-test</phase>
                        <goals>
                            <goal>aggregate</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
```
# Generating reports via CICD pipeline
Under .guthub/workflows, a pipeline.yml as been created which will do CI operations and build the code.

The pipeline will automatically start when a new commit is added to the repository

Link to Yaml : https://github.com/prernaraina1989/LeasePlan/blob/main/.github/workflows/pipeline.yml

Below code snippet in the pipeline will generate the report via pipeline

```
- uses: actions/upload-artifact@v3
        with:
          name: report
          path: target/site/serenity
```
Under repository LeasePlan navigate to Actions tab, a workflow named Continuous Integration is created which contains all the workflow runs.

To see the report of last pipeline run, 

click on latest commit "**Update SearchStepDefinitions.java to adjust positive negative scenarios**"

Click on report at the bottom of this page

It will download the report in  zip file.

Extract the zip file content and click on index.html which will show the execution report of the Serenity test cases

## Instructions
# How to install
  Prequisites: 
   Git
   Java 8 or higher
   Maven 2.x or higher
   IDE - Eclipse/Intellij or anyother
  
  Goto https://github.com/prernaraina1989/LeasePlan
  
  Click on Code with dropdown
  
  Copy the https link and clone it using GIT in your local system
  
  Now Open you project on IDE and run Maven command "mvn clean install"
  
  Check if all required repositories are downloaded

# How to Run
  To run the project, you can either just run the `CucumberTestSuite` test runner class, or run either `mvn clean verify` from the command line.
  
The test results will be recorded in the `target/site/serenity` directory

# How to Write new Testcases
1. Goto the get_product.feature file which can be found in test/resources/feature/search
   
   In this file you can add your scenarios or you can create another feature file under same structure
      
    Make sure to give your scenario properly name for reports purpose


2. Now to add step definitions, go to the file SearchStepDefinitions.java which could be found in test/java/starter/stepdefinitions 

   In this file you can add your stepsdefinations or you can create another stepdefinition file under same structure

   [Note: you need to update pom.xml accordingly if you are using any other dependencies]


3. Now Run your project and check results

# What was refactored in code
Changes were made like - 

1.Renaming of Method names in SearchStepDefinitions.java file according to the method name convention in java serenity cucumber framework

2.Refactoring of code, to make it more readable

3.Removing of unnecessary code to make it more readable

5.Adding different scenarios to make report more presentable and readable

4.Renaming of Feature file name to get_product.feature from post_product.feature, to make it clear what exactly we are doing in this feature file

See [**this article**](https://johnfergusonsmart.com/environment-specific-configuration-in-serenity-bdd/) for more details about this feature.

## Want to learn more?
For more information about Serenity BDD, you can read the [**Serenity BDD Book**](https://serenity-bdd.github.io/theserenitybook/latest/index.html), the official online Serenity documentation source. Other sources include:
* **[Byte-sized Serenity BDD](https://www.youtube.com/channel/UCav6-dPEUiLbnu-rgpy7_bw/featured)** - tips and tricks about Serenity BDD
* For regular posts on agile test automation best practices, join the **[Agile Test Automation Secrets](https://www.linkedin.com/groups/8961597/)** groups on [LinkedIn](https://www.linkedin.com/groups/8961597/) and [Facebook](https://www.facebook.com/groups/agiletestautomation/)
* [**Serenity BDD Blog**](https://johnfergusonsmart.com/category/serenity-bdd/) - regular articles about Serenity BDD
